<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Relatório de Tanque - Volume Real e Percentual</title>
<style>
body { font-family: Arial, sans-serif; background:#f0f0f0; padding:20px; }
input, select, button { padding:6px; margin:5px 0; width:100%; box-sizing:border-box; }
button { background:#007bff; color:white; border:none; cursor:pointer; }
.resultado, .tabela, .conteudo-pdf { background:white; padding:15px; margin-top:15px; }
h2,h3 { margin-bottom:8px; }
table { border-collapse: collapse; width:100%; font-size:12px; }
table, th, td { border:1px solid #444; }
th { background:#007bff; color:white; padding:6px; text-align:center; }
td { padding:4px; text-align:center; }
.highlight { background-color:#d1ffd1; }
.pdf-header { text-align:center; margin-bottom:15px; }
.tanque-diagrama { position: relative; border:2px solid #444; width:300px; height:150px; margin:10px 0; background:#eee; }
.nivel-inicial { position:absolute; bottom:0; width:100%; background:rgba(0,123,255,0.5); }
.nivel-final { position:absolute; bottom:0; width:100%; background:rgba(40,167,69,0.5); }
</style>
</head>
<body>

<h2>Calculadora de Volume do Tanque - Real e Percentual</h2>

<div class="conteudo-pdf">
<div class="pdf-header"><h2>Relatório de Volume do Tanque</h2></div>

<label>Tipo de tanque</label>
<select id="tipoTanque">
    <option value="cilindrico" selected>Cilíndrico Horizontal</option>
    <option value="retangular">Retangular</option>
</select>

<h3>Dimensões do tanque</h3>
<label>Altura do tanque (cm)</label>
<input type="number" id="altura" step="0.1">

<label>Largura do tanque (cm) - para retangular</label>
<input type="number" id="largura" step="0.1">

<label>Comprimento do tanque (cm)</label>
<input type="number" id="comprimento" step="0.1">

<hr>
<h3>Estoque</h3>
<label>Altura do estoque inicial (cm)</label>
<input type="number" id="estoqueInicial" step="0.1">

<label>Altura do estoque final (cm)</label>
<input type="number" id="estoqueFinal" step="0.1">

<hr>
<h3>Temperatura do combustível</h3>
<label>Temperatura carregado (°C)</label>
<input type="number" id="tempCarregado" step="0.1">

<label>Temperatura descarregado (°C)</label>
<input type="number" id="tempDescarregado" step="0.1">

<button onclick="calcular()">Calcular Volume</button>
<button onclick="exportarPDF()">Exportar PDF</button>

<div class="resultado">
<h3>Resultado:</h3>
Volume inicial: <span id="volIni">0</span> L<br>
Volume final: <span id="volFin">0</span> L<br>
Variação de volume: <span id="volVar">0</span> L<br>
Capacidade total do tanque: <span id="capTotal">0</span> L<br>
Percentual inicial do tanque: <span id="percIni">0</span>%<br>
Percentual final do tanque: <span id="percFin">0</span>%
</div>

<div class="tanque-diagrama" id="diagrama">
    <div class="nivel-inicial" id="nivelIni" style="height:0%"></div>
    <div class="nivel-final" id="nivelFin" style="height:0%"></div>
</div>

<div class="tabela" id="tabelaVolumes">
<h3>Tabela Compacta Altura × Volume (L)</h3>
<table id="tabela"></table>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
function calcular(){
    let tipo = document.getElementById("tipoTanque").value;
    let alturaTanque = parseFloat(document.getElementById("altura").value);
    let largura = parseFloat(document.getElementById("largura").value);
    let comprimento = parseFloat(document.getElementById("comprimento").value);
    let hIni = parseFloat(document.getElementById("estoqueInicial").value);
    let hFin = parseFloat(document.getElementById("estoqueFinal").value);
    let tempIni = parseFloat(document.getElementById("tempCarregado").value);
    let tempFin = parseFloat(document.getElementById("tempDescarregado").value);

    if(!hIni || !hFin){ alert("Preencha a altura do estoque inicial e final."); return; }

    let coef = 0.00095;
    let fatorTemp = 1 + coef * (tempFin - tempIni);

    function volumeCilindro(h){
        let R = alturaTanque/2;
        if(h <= R){
            return comprimento * ( Math.pow(R,2) * Math.acos((R-h)/R) - (R-h)*Math.sqrt(2*R*h - Math.pow(h,2)) );
        } else {
            let hComp = 2*R - h;
            let seg = comprimento * ( Math.pow(R,2) * Math.acos((R-hComp)/R) - (R-hComp)*Math.sqrt(2*R*hComp - Math.pow(hComp,2)) );
            return Math.PI*Math.pow(R,2)*comprimento - seg;
        }
    }

    // Calcula volume total do tanque
    let volTotal = tipo==="retangular" ? largura*comprimento*alturaTanque/1000 : Math.PI*(alturaTanque/2)**2*comprimento/1000;

    // Volumes inicial e final com ajuste de temperatura
    let volIni = tipo==="retangular" ? largura*comprimento*hIni*fatorTemp/1000 : volumeCilindro(hIni)*fatorTemp/1000;
    let volFin = tipo==="retangular" ? largura*comprimento*hFin*fatorTemp/1000 : volumeCilindro(hFin)*fatorTemp/1000;
    let variacao = volFin - volIni;

    document.getElementById("volIni").innerText = volIni.toFixed(2);
    document.getElementById("volFin").innerText = volFin.toFixed(2);
    document.getElementById("volVar").innerText = variacao.toFixed(2);
    document.getElementById("capTotal").innerText = volTotal.toFixed(0);
    document.getElementById("percIni").innerText = ((volIni/volTotal)*100).toFixed(1);
    document.getElementById("percFin").innerText = ((volFin/volTotal)*100).toFixed(1);

    // Diagrama visual
    let nivelIni = (hIni/alturaTanque)*100;
    let nivelFin = (hFin/alturaTanque)*100;
    document.getElementById("nivelIni").style.height = nivelIni + "%";
    document.getElementById("nivelFin").style.height = nivelFin + "%";

    // Tabela compacta em colunas
    if(tipo==="cilindrico"){
        let colunas = 5;
        let rows = Math.ceil(alturaTanque/colunas);
        let tabela = "<tr>";
        for(let c=0;c<colunas;c++){ tabela += "<th>Altura (cm)</th><th>Volume (L)</th>"; }
        tabela += "</tr>";

        for(let r=0;r<rows;r++){
            let linha = "<tr>";
            for(let c=0;c<colunas;c++){
                let h = r + c*rows +1;
                if(h>alturaTanque){ linha+="<td></td><td></td>"; }
                else {
                    let v = volumeCilindro(h)/1000;
                    let classe = (h>=hIni && h<=hFin) ? " class='highlight'" : "";
                    linha += `<td${classe}>${h}</td><td${classe}>${v.toFixed(2)}</td>`;
                }
            }
            linha += "</tr>";
            tabela += linha;
        }
        document.getElementById("tabela").innerHTML = tabela;
    } else { document.getElementById("tabela").innerHTML = "<tr><td colspan='10'>Tabela disponível apenas para tanque cilíndrico</td></tr>"; }
}

function exportarPDF(){
    let diagrama = document.getElementById("diagrama").outerHTML;
    let conteudo = document.createElement('div');
    conteudo.innerHTML = `
        <div style="font-family: Arial; padding:10px;">
        <h2 style="text-align:center;">Relatório de Volume do Tanque</h2>
        <h3>Dados do Tanque</h3>
        Tipo: ${document.getElementById("tipoTanque").value}<br>
        Altura: ${document.getElementById("altura").value} cm<br>
        Largura: ${document.getElementById("largura").value} cm<br>
        Comprimento: ${document.getElementById("comprimento").value} cm<br>
        <h3>Estoque</h3>
        Inicial: ${document.getElementById("estoqueInicial").value} cm<br>
        Final: ${document.getElementById("estoqueFinal").value} cm<br>
        <h3>Temperatura</h3>
        Carregado: ${document.getElementById("tempCarregado").value} °C<br>
        Descarregado: ${document.getElementById("tempDescarregado").value} °C<br>
        <h3>Resultados</h3>
        Volume inicial: ${document.getElementById("volIni").innerText} L<br>
        Volume final: ${document.getElementById("volFin").innerText} L<br>
        Variação de volume: ${document.getElementById("volVar").innerText} L<br>
        Capacidade total: ${document.getElementById("capTotal").innerText} L<br>
        Percentual inicial: ${document.getElementById("percIni").innerText}%<br>
        Percentual final: ${document.getElementById("percFin").innerText}%<br>
        <h3>Diagrama do Tanque</h3>
        ${diagrama}
        <h3>Tabela Compacta Altura × Volume</h3>
        ${document.getElementById("tabelaVolumes").innerHTML}
        </div>
    `;
    let opt = { margin:0.5, filename:'relatorio_tanque_percentual.pdf', image:{type:'jpeg', quality:0.98}, html2canvas:{scale:2}, jsPDF:{unit:'in', format:'a4', orientation:'landscape'} };
    html2pdf().set(opt).from(conteudo).save();
}
</script>
</body>
</html>
